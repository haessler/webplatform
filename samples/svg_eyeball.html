<html>
<head>
<title>SVG grand tour demo</title>

<style>

body {
    background         : #ddd;
    font-family        : Trebuchet MS;
}

svg {
    background         : #fff;
}

.eyelid {
    fill               : none;
}

form {
    margin             : 1em;
    padding            : 1em;
    border-radius      : 1em;
    background         : #fff;
}

#eyelashes {
    font-size          : 40;
}

/* pattern within eye */

#pupil, #iris {
    stop-color         : lightblue;
    -webkit-transition : all 5s;
}

#white, #bloodshotExtent {
    stop-color         : white;
}

#inner {
    stop-color         : black;
}

#outer {
    stop-color         : pink;
}

form {
   line-height         : 2;
}

span {
    border             : lightgreen solid medium; 
    padding            : 0.25em; 
    border-radius      : 0.5em; 
    cursor             : pointer;
}

</style>

</head>
<body>

<svg width="600" height="400" viewBox="0 0 600 200">

<defs>

<!-- eyeball -->

<circle
    id         = "eyeball"
    cx         = "100"
    cy         = "100"
    r          = "150"
    fill       = "url(#eyeballFill)"
    transform  = "translate(0,0)"
>

    <animateTransform
        id             = "glanceStart"
        attributeType  = "XML"
        attributeName  = "transform"
        type           = "translate"
        from           = "0 0"
        to             = "50 0"
        calcMode       = "paced"
        begin          = "1s"
        dur            = "0.5s"
        repeatCount    = "1"
        restart        = "whenNotActive"
    />

    <animateTransform
        id             = "glanceEnd"
        attributeType  = "XML"
        attributeName  = "transform"
        type           = "translate"
        from           = "50 0"
        to             = "0 0"
        begin          = "glanceStart.end"
        dur            = "0.5s"
        calcMode       = "linear"
        repeatCount    = "1"
        restart        = "whenNotActive"
    />

</circle>


<!-- eyelids -->

<path
    filter       = "url(#soften)"
    id           = "eyelids"
    d            = "M 200,100 Q 100,200 0,100 Q 100,0 200,100"
    fill         = "transparent"
    stroke       = "#aaa"
    stroke-width = "2"
>

    <animate
        id            = "blink"
        attributeType = "XML"
        attributeName = "d"
        from          = "M 200,100 Q 100,200 0,100 Q 100,0 200,100"
        to            = "M 200,100 Q 100,100 0,100 Q 100,100 200,100"
        begin         = "4s;6s;9s;11s;14s;17s;20s"
        dur           = "0.1s"
    />

</path>

<clipPath id="clipEyelid">
    <use xlink:href="#eyelids" />
</clipPath>

<!-- eyelashes -->

<text
    id                 = "eyelashes"
    filter             = "url(#soften)"
>
  <textPath xlink:href = "#eyelids">
    <tref
      id               = "eyelashTextRef"
      xlink:href       = "#eyelashContent"
      font-size        = "20"
      letter-spacing   = "4"
      font-style       = "italic"
      stroke           = "#ddd"
    />
  </textPath>
</text>

<text id="eyelashContent" >
llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll
</text>

<!-- entire eye -->

<g id="eye">
  <use xlink:href="#eyeball" clip-path="url(#clipEyelid)" />
  <use xlink:href="#eyelids" />
  <use xlink:href="#eyelashes" />
</g>

<!-- animations -->

<!-- filters -->

<filter
    id           = "soften"
    x            = "-20"
    y            = "-20"
    width        = "250"
    height       = "250"
    filterUnits  = "userSpaceOnUse"
>
  <desc>soften eyelashes</desc>

  <feGaussianBlur stdDeviation = "1 3" />
  <feComponentTransfer>
      <feFuncR type="linear" slope="0.3"/>
      <feFuncG type="linear" slope="0.3"/>
      <feFuncB type="linear" slope="0.3"/>
  </feComponentTransfer>

</filter>

<radialGradient id="eyeballFill">
  <stop id="inner"           offset="12%"  />
  <stop id="pupil"           offset="15%"  />
  <stop id="iris"            offset="27%"  />
  <stop id="white"           offset="30%"  />
  <stop id="bloodshotExtent" offset="40%"  />
  <stop id="outer"           offset="100%" />
</radialGradient>

<g id="eyes">
  <use xlink:href="#eye" transform="translate(50,0)"/>
  <use xlink:href="#eye" transform="translate(350,0)"/>
</g>

</defs>

<use xlink:href="#eyes"/>

<!--

-->






</svg>

<form>

<b>JavaScript manual override</b>

<br/><label>blink</label>
<input id = "blinkInput" type = "range" min = "0" max = "100" value = "100" />

<br/><label>glance X</label>
<input class = "glanceX" id = "glanceXinput" type = "range" min = "-50" max = "50" value = "0" />

<br/><label>glance Y</label>
<input class = "glanceY" id = "glanceYinput" type = "range" min = "-30" max = "30" value = "0" />

<br/><label>eye color</label>
<select>
  <option>lightblue</option>
  <option>brown</option>
</select>

<br/>

<span onclick="app.blink.beginElementAt(0)">replay blink</span>
<span onclick="app.glanceStart.beginElementAt(0)">replay glance</span>
<span onclick="app.svg.setCurrentTime(0)">replay sequence of both</span>

</form>

<script>

var app = new Function();

window.onload = function() {
    app.svg = document.querySelector('svg');
    app.eyelids = document.querySelector('#eyelids');
    app.eyelashes = document.querySelector('#eyelashTextRef');
    app.eyeball = document.querySelector('#eyeball');
    app.pupil = document.querySelector('#pupil');
    app.iris = document.querySelector('#iris');
    app.glanceStart = document.querySelector('#glanceStart');
    app.blink = document.querySelector('#blink');

    app.glanceX = 0;
    app.glanceY = 0;

    app.colorInput = document.querySelector('select');
    app.colorInput.addEventListener('change', app.changeEyeColor);

    app.blinkInput = document.querySelector('#blinkInput');
    app.blinkInput.addEventListener('change', app.moveEyelid);
    app.glanceXinput = document.querySelector('#glanceXinput');
    app.glanceYinput = document.querySelector('#glanceYinput');
    app.glanceXinput.addEventListener('change', app.moveEyeball);
    app.glanceYinput.addEventListener('change', app.moveEyeball);
}

app.changeEyeColor = function(e) {
    app.pupil.setAttribute('style', "stop-color:" + e.target.value);
    app.iris.setAttribute('style', "stop-color:" + e.target.value);
}

app.moveEyeball = function(e) {
    app[e.target.className] = e.target.value;
    console.log(app.glanceX + " " + app.glanceY);
    app.eyeball.setAttribute('transform', 'translate(' + app.glanceX + " " + app.glanceY + ')');
}

app.moveEyelid = function(e) {
    var m = 0.05;
    var path = 'M 200,100 Q 100,' + (100 + e.target.valueAsNumber)
        + ' 0,100 Q 100,' + (100 - e.target.valueAsNumber) + ' 200,100';
    app.eyelids.setAttribute('d', path);
};

</script>

</body>
</html>

