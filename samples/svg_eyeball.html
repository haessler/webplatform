<html>
<head>
<title>SVG grand tour demo</title>
<link href='css/svg_eyeball.css' type='text/css' rel='stylesheet'/>

<style>

form { width: 600; }

</style>

</head>
<body>

<svg width="600" height="300" viewBox="0 0 600 200" preserveAspectRatio="xMidYMid">

<defs>

<!-- eyeball -->

<circle
    id         = "eyeball"
    cx         = "100"
    cy         = "100"
    r          = "150"
    fill       = "url(#eyeballFill)"
    transform  = "translate(0,0)"
>

    <animateTransform
        id             = "glanceStart"
        attributeType  = "XML"
        attributeName  = "transform"
        type           = "translate"
        from           = "0 0"
        to             = "50 0"
        data-calcMode       = "paced"
        begin          = "1s"
        dur            = "0.5s"
        restart        = "whenNotActive"
    />

    <animateTransform
        id             = "glanceEnd"
        attributeType  = "XML"
        attributeName  = "transform"
        type           = "translate"
        from           = "50 0"
        to             = "0 0"
        begin          = "glanceStart.end"
        dur            = "0.5s"
        data-calcMode       = "paced"
        restart        = "whenNotActive"
    />

<!-- Q: why can't I "use" an animation? -->

<!-- Q: can I repeat an animation 2x, the 2nd time in reverse? Want
     behavior like CSS's animation-direction. Otherwise, seem to need
     sequence of 2 <animate> tags -->

</circle>

<!-- eyelids -->

<path
    filter       = "url(#soften)"
    id           = "eyelids"
    d            = "M 200,100 Q 100,200 0,100 Q 100,0 200,100"
    fill         = "transparent"
    stroke       = "#333"
>

    <animate
        id            = "blink"
        attributeType = "XML"
        attributeName = "d"
        from          = "M 200,100 Q 100,200 0,100 Q 100,0 200,100"
        to            = "M 200,100 Q 100,100 0,100 Q 100,100 200,100"
        begin         = "4s; 6s"
        dur           = "0.1s"
    />

<!-- Q: can't reliably repeat >1 'begin' time value -->

</path>

<clipPath id="clipEyelid">
    <use xlink:href="#eyelids" />
</clipPath>

<!-- eyelashes -->

<text
    id                 = "eyelashes_OLD"
    filter             = "url(#soften)"
>
  <textPath xlink:href = "#eyelids">
    <tref
      id               = "eyelashTextRef"
      xlink:href       = "#eyelashContent"
      font-size        = "20"
      letter-spacing   = "4"
      font-style       = "italic"
      stroke           = "#ddd"
    />
  </textPath>
</text>

<text id="eyelashContent" >
llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll
</text>

<!-- entire eye -->

<g id="eye">
  <use
     xlink:href="#eyeball" 
     clip-path="url(#clipEyelid)"
     />
  <use 
     xlink:href="#eyelids" 
     stroke-width="2"
     />

  <use 
     xlink:href="#eyelids" 
     stroke-width="20" 
     stroke-miterlimit="1"
     stroke-dasharray="1,10"
     transform="scale(1.10) translate(-10,-10)"
     data-style="transform-origin:center;transform:scale(1.2);-webkit-transform-origin:center;-webkit-transform:scale(1.2)"
     />

</g>

<!-- animations -->

<!-- filters -->

<filter
    id           = "soften"
    x            = "-20"
    y            = "-20"
    width        = "250"
    height       = "250"
    filterUnits  = "userSpaceOnUse"
>
  <desc>soften eyelashes</desc>

  <feGaussianBlur stdDeviation = "1 3" />
  <feComponentTransfer>
      <feFuncR type="linear" slope="0.3"/>
      <feFuncG type="linear" slope="0.3"/>
      <feFuncB type="linear" slope="0.3"/>
  </feComponentTransfer>

</filter>

<radialGradient id="eyeballFill">
  <stop id="inner"           offset="12%"  />
  <stop id="pupil"           offset="15%"  />
  <stop id="iris"            offset="27%"  />
  <stop id="white"           offset="30%"  />
  <stop id="bloodshotExtent" offset="40%"  />
  <stop id="outer"           offset="100%" />
</radialGradient>

<g id="eyes">
  <use xlink:href="#eye" transform="translate(50,0)"/>
  <use xlink:href="#eye" transform="translate(350,0)"/>
</g>

<marker id="dot" markerWidth="2" markerHeight="2" refX="2" refY="2" orient="auto">
    <circle r="2" cx="10" cy="10" fill="red"/>
</marker>



</defs>

<use xlink:href="#eyes"/>

<!--
<g transform="translate(100,0)">
<path d = "M 200,100 Q 100,100 0,100 Q 100,100 200,100" fill =
    "transparent" stroke = "#aaa" stroke-width = "2" />
<polyline points="200,100 100,100 0,100" fill="none" stroke="red" stroke-dasharray="5,5"/>
<polyline points="0,100  100,100 200,100" fill="none" stroke="red" stroke-dasharray="5,5"/>
<circle r="4" cx="100" cy="100" fill="red"/>
<circle r="4" cx="100" cy="100" fill="red"/>
</g>
-->

</svg>

<form>

<b>JavaScript manual override</b>

<br/><label>blink</label>
<input id = "blinkInput" type = "range" min = "0" max = "100" value = "100" />

<br/><label>glance X</label>
<input class = "glanceX" id = "glanceXinput" type = "range" min = "-50" max = "50" value = "0" />

<br/><label>glance Y</label>
<input class = "glanceY" id = "glanceYinput" type = "range" min = "-30" max = "30" value = "0" />

<br/><label>eye color</label>
<select>
  <option>lightblue</option>
  <option>brown</option>
</select>

<br/>

<span onclick="app.blink.beginElement()">replay blink</span>
<span onclick="app.glanceStart.beginElement()">replay glance</span>
<span onclick="app.svg.setCurrentTime(0)">replay sequence of both</span>
<span onclick="app.keepBlinking()">keep blinking</span>

</form>

<script src="js/svg_eyeball.js">
</script>

</body>
</html>

