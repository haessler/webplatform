<html>
<head>

<title>interactive SVG path tool</title>

<style>

fieldset {
    border-radius : 0.5em;
    line-height: 1.25;
    margin-bottom: 0.25em;
}

form {
    background    : #fff;
    padding       : 0.5em;
    border-radius : 0.5em;
    position      : absolute;
    left          : 720px;
    top           : 20px;
    width         : 300px;
}

body {
    background    : #aaa;
    font-family   : Trebuchet MS;
}

span {
    border        : medium solid pink;
}

svg {
    stroke        : black;
    stroke-width  : 2;
}

p:empty {
    display: none;
}

p {
    padding: 0.5em;
    border-radius: 0.5em;
    background    : #fff;
    font-family   : monospace;
}

line {
    stroke-width  : 2;
}

section {
    width         : 700px;
    height        : 700px;
    background    : #fff;
}

marker {
    fill: none;
}

#arrowhead {
    fill          : black;
    stroke        : transparent;
    stroke-width  : 1;
}

polyline {
    display: none;
    fill: none;
    stroke: red;
    stroke-opacity: 1;
    stroke-dasharray: 5,5;
    stroke-width: 2;
    marker-mid: url(#dot);
    marker-end: url(#dot);
}


</style>

</head>
<body>

<section>
<svg>

<defs>
  <marker id="arrowhead" markerWidth="10" markerHeight="10" orient="auto" refY="5">
    <polygon points="0,0 10,5 0,10"/>
  </marker>
  <marker id="dot" markerWidth="4" markerHeight="4" refX="0" refY="2" orient="auto">
    <circle fill="black" cx="2" cy="2" r="4"/>
  </marker>
</defs>

<polyline points="0,0"/>
<path d="M 0,0" fill="transparent"/>

</svg>
</section>

<form>

<fieldset>
<legend>path command</legend>
<select class="tool">
    <option value="M">M</option>
    <option value="L">L (line to)</option>
    <option value="H">H (horizontal line to)</option>
    <option value="V">V (vertical line to)</option>
    <option value="Q">Q (quadratic bezier curve to)</option>
    <option value="T">T (smooth quadratic curve)</option>
    <option value="C">C (cubic bezier curve to)</option>
    <option value="S">S (smooth cubic curve)</option>
    <option value="A">A (elliptical arc)</option>
    <option value="z">z (close subpath)</option>
</select>

</fieldset>

<fieldset>
<legend>arc</legend>

<label>X radius</label>
<input type="range" id="arcRadX" value="200" min="0" max="500"  onchange="app.arcRadiusX = this.value"/>

<br/><label>Y radius</label>
<input type="range" id="arcRadY" value="200" min="0" max="500"  onchange="app.arcRadiusY = this.value"/>

<br/><label>rotation</label>
<input type="range" id="rotatearc" value="0" min="-360" max="360"  onchange="app.rotateArc = this.value"/>

<br/><input type="checkbox" id="largearc"  onchange="this.checked ? (app.largeArc = 1) : (app.largeArc = 0)"/>
<label>large arc? (&gt;180&deg;)</label>

<br/><input type="checkbox" id="sweeparc"  onchange="this.checked ? (app.sweepArc = 1) : (app.sweepArc = 0)"/>
<label>sweep arc? (clockwise path)</label>

</fieldset>

<fieldset>
<legend>fill</legend>
<label>color</label>
<input onchange="app.path.setAttribute('fill', this.value)" type="color" value="transparent"/>

<br/><label>fill-rule</label>
<select onchange="app.path.setAttribute('fill-rule', this.value)" >
<option selected>nonzero</option>
<option>evenodd</option>
</select>
</fieldset>

<fieldset>
<legend>stroke</legend>
<label>color</label>
<input onchange="app.path.setAttribute('stroke', this.value)" type="color" value="black"/>

<br/>
<label>width</label>
<input type="range" min="1" max="10" value="1" onchange="app.path.setAttribute('stroke-width', this.value)" />

</fieldset>

<fieldset>
<legend>marker reference</legend>

<label>property</label>
<select id="selMarkerProp" onchange="app.path.setAttribute('style', this.value + ':' + document.querySelector('#selMarkerValue').value);console.log(app.path)">
<option>marker-end</option>
<option>marker-start</option>
<option>marker-mid</option>
<option>marker</option>
</select>

<br/>
<label>shape</label>
<select id="selMarkerValue" onchange="app.path.setAttribute('style', document.querySelector('#selMarkerProp').value + ':' + this.value);app.marker=this.value.replace(/url(/, '').replace(/)/, '')">
<option selected>url(#arrowhead)</option>
<option>url(#dot)</option>
<option>none</option>
</select>

</fieldset>

<fieldset>
<legend>marker element</legend>

<label>orient</label>
<select onchange="document.querySelector(app.marker).setAttribute('orient', this.value)">
<option selected>auto</option>
<option>0</option>
<option>30</option>
<option>60</option>
<option>90</option>
<option>180</option>
</select>

<br/><label>refX</label>
<input type="range" min="0" max="10" value="5"
onchange="document.querySelector(app.marker).setAttribute('refX', this.value)" />

<br/><label>refY</label>
<input type="range" min="0" max="10" value="5"
onchange="document.querySelector(app.marker).setAttribute('refY', this.value)" />

<br/><label>markerWidth</label>
<input type="range" min="0" max="10" value="5"
onchange="document.querySelector(app.marker).setAttribute('markerWidth', this.value)" />

<br/><label>markerHeight</label>
<input type="range" min="0" max="10" value="5"
onchange="document.querySelector(app.marker).setAttribute('markerHeight', this.value)" />

<label>markerUnits</label>
<select onchange="document.querySelector(app.marker).setAttribute('markerUnits', this.value)">
<option selected>userSpaceOnUse</option>
<option>strokeWidth</option>
</select>


</fieldset>

</form>

<p></p>

<script>
var app = new Function();

app.rotateArc = 0;
app.sweepArc = 0;
app.largeArc = 0;
app.arcRadiusX = 200;
app.arcRadiusY = 200;

app.marker = '#arrowhead';

window.onload = function() {
    app.dbg = document.querySelector("p");
    app.path = document.querySelector("path");
    app.polyline = document.querySelector("polyline");
    app.sect = document.querySelector("section");
    app.svg = document.querySelector("svg");

    app.c1 = document.querySelector("#c1");
    app.c2 = document.querySelector("#c2");
    app.l1s = document.querySelector("#l1s");
    app.l1e = document.querySelector("#l1e");
    app.l1x = document.querySelector("#l1x");
    app.l2s = document.querySelector("#l2s");
    app.l2e = document.querySelector("#l2e");
    app.l2x = document.querySelector("#l2x");

    app.toolSelect = document.querySelector("select.tool");

    app.svg.addEventListener("mousedown", app.handleClick);

    app.toolSelect.addEventListener("change", app.changeTool);
    app.tool = app.toolSelect.value;

    app.req = {"M":1,"L":1,"H":1,"V":1,"Q":2,"C":3,"T":1,"S":2,"A":1};
    app.refresh();
}

app.refresh = function() {
    app.points = [];
    // app.c1.setAttribute('cx', '-10');
    // app.c1.setAttribute('cy', '-10');
    // app.c2.setAttribute('cx', '-10');
    // app.c2.setAttribute('cy', '-10');
};

app.changeTool = function(e) {
    var d;
    app.tool = e.target.value;
    app.refresh();
    if (app.tool == 'z') {
        d = app.path.getAttribute("d") + ", Z";
        app.path.setAttribute("d", d);        
        e.target.value = "M";
        app.tool = "M";
    }
};

app.handleClick = function(e) {
    app.points.push(e.offsetX + "," + e.offsetY);
    app.render();
}

app.render = function() {
    var attr;
    var d;

    if (app.points.length < app.req[app.tool]) {
        return(false);
    }

    if (app.tool == "A") {
        attr = " A ";
        attr += app.arcRadiusX + ",";
        attr += app.arcRadiusY + " ";
        attr += app.rotateArc + " ";
        attr += app.largeArc + " ";
        attr += app.sweepArc + " ";
        attr += app.points[0];
    } else {
        attr = " " + app.tool + " ";
        attr += app.points.join(" ");
    }

    d = app.path.getAttribute("d") + attr;
    app.path.setAttribute("d", d);

    app.polyline.setAttribute("points", d.replace(/[A-Z] /g, ""));

    app.refresh();
    app.d( app.sect.innerHTML.replace(/<defs[^`]+?<\/defs>/gim, "") );
};

app.d = function(s) {
    app.dbg.textContent = s;
}

</script>

</body>
</html>
