<html>
<head>

<title>interactive SVG path tool</title>

<style>

body {
    font-family  : Trebuchet MS;
}

span {
    border: medium solid pink;
}

svg {
    stroke       : black;
    stroke-width : 2;
    width        : 100%;
    height       : 80%;
    border       : medium solid gold;
    fill         : transparent;
}

p {
    font-family  : monospace;
}

line {
    stroke-width: 2;
}

</style>

</head>
<body>

<section>
<svg>
<path d="M 0,0"/>
<circle id="c1" stroke="red" r="4" cx="-10" cy="-10"/>
<circle id="c2" stroke="red" r="4" cx="-10" cy="-10"/>
<line id="l1s" stroke="lightgreen" x1="-44" y1="-44" x2="-88" y2="-88"/>
<line id="l1e" stroke="lightblue"  x1="-44" y1="-44" x2="-88" y2="-88"/>
<line id="l1x" stroke="pink"       x1="-44" y1="-44" x2="-88" y2="-88"/>
<line id="l2s" stroke="green"      x1="-44" y1="-44" x2="-88" y2="-88"/>
<line id="l2e" stroke="blue"       x1="-44" y1="-44" x2="-88" y2="-88"/>
<line id="l2x" stroke="red"        x1="-44" y1="-44" x2="-88" y2="-88"/>
</svg>
</section>

<label>Path Command:</label>

<select class="tool">
    <option value="M">M</option>
    <option value="L">L (line to)</option>
    <option value="H">H (horizontal line to)</option>
    <option value="V">V (vertical line to)</option>
    <option value="Q">Q (quadratic bezier curve to)</option>
    <option value="T">T (foo)</option>
    <option value="C">C (cubic bezier curve to)</option>
    <option value="S">S (foo)</option>
    <option value="A">A (elliptical arc)</option>
    <option value="z">z (close subpath)</option>
</select>

<label>fill</label>
<input onchange="app.path.setAttribute('fill', this.value)" type="color" value="transparent"/>

<label>fill-rule</label>

<select onchange="app.path.setAttribute('fill-rule', this.value)" >
<option selected>nonzero</option>
<option>evenodd</option>
</select>

<label>large arc?</label>
<input type="checkbox" id="largearc"  onchange="this.checked ? (app.largeArc = 1) : (app.largeArc = 0)"/>

<label>sweep arc?</label>
<input type="checkbox" id="sweeparc"  onchange="this.checked ? (app.sweepArc = 1) : (app.sweepArc = 0)"/>


<label>rotate arc</label>
<input type="range" id="rotatearc" value="0" min="-360" max="360"  onchange="app.rotateArc = this.value"/>

<p></p>

<script>
var app = new Function();

app.rotateArc = 0;
app.sweepArc = 0;
app.largeArc = 0;

window.onload = function() {
    app.dbg = document.querySelector("p");
    app.path = document.querySelector("path");
    app.sect = document.querySelector("section");
    app.svg = document.querySelector("svg");

    app.c1 = document.querySelector("#c1");
    app.c2 = document.querySelector("#c2");
    app.l1s = document.querySelector("#l1s");
    app.l1e = document.querySelector("#l1e");
    app.l1x = document.querySelector("#l1x");
    app.l2s = document.querySelector("#l2s");
    app.l2e = document.querySelector("#l2e");
    app.l2x = document.querySelector("#l2x");

    app.toolSelect = document.querySelector("select.tool");

    app.svg.addEventListener("mousedown", app.handleClick);

    app.toolSelect.addEventListener("change", app.changeTool);
    app.tool = app.toolSelect.value;

    app.req = {"M":1,"L":1,"H":1,"V":1,"Q":2,"C":3,"T":1,"S":2,"A":2};
    app.refresh();
}

app.refresh = function() {
    app.points = [];
    // app.c1.setAttribute('cx', '-10');
    // app.c1.setAttribute('cy', '-10');
    // app.c2.setAttribute('cx', '-10');
    // app.c2.setAttribute('cy', '-10');
};

app.changeTool = function(e) {
    var d;
    app.tool = e.target.value;
    app.refresh();
    if (app.tool == 'z') {
        d = app.path.getAttribute("d") + ", Z";
        app.path.setAttribute("d", d);        
        e.target.value = "M";
        app.tool = "M";
    }
};

app.handleClick = function(e) {
    app.points.push(e.offsetX + "," + e.offsetY);
    app.render();
}

app.render = function() {
    var attr;
    var d;

    if (app.points.length < app.req[app.tool]) {
        return(false);
    }

    if (app.tool == "A") {
        attr = " A ";
        attr += app.points[0] + " ";
        attr += app.rotateArc + " ";
        attr += app.largeArc + " ";
        attr += app.sweepArc + " ";
        attr += app.points[1];
    } else {
        attr = " " + app.tool + " ";
        attr += app.points.join(" ");
    }

    d = app.path.getAttribute("d") + attr;
    app.path.setAttribute("d", d);

    app.refresh();
    app.d( app.sect.innerHTML.replace(/<circle.+?<\/circle>/g, "").replace(/<line.+?<\/line>/g, "") );
};

app.d = function(s) {
    app.dbg.textContent = s;
}

</script>

</body>
</html>
