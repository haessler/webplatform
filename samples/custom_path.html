<html>
<head>
<title>CSS custom filters + 3D transforms</title>

<style>

* {
    pointer-events              : none;
}

body {
    background                  : #aaa;
}

.scene {
    -webkit-perspective         : 1000;
    -webkit-transform-style     : preserve-3d;
    -moz-perspective         : 1000;
    -moz-transform-style     : preserve-3d;
    perspective         : 1000;
    transform-style     : preserve-3d;
    height                      : 100%;
}

.ground {
    border-radius               : 20% 20%;
    border                      : thick solid #777;
    background                  : transparent;
    background-image            : url(img/ground_floor.jpg);
    background-size             : 100% 100%;
    -webkit-transform           : rotateX(80deg) scale(0.9);
    -webkit-perspective         : 5000;
    -webkit-transform-style     : preserve-3d;
    -moz-transform           : rotateX(80deg) scale(0.9);
    -moz-perspective         : 5000;
    -moz-transform-style     : preserve-3d;
    transform           : rotateX(80deg) scale(0.9);
    perspective         : 5000;
    transform-style     : preserve-3d;
    height                      : 1000;
    pointer-events              : auto;
}

.card, .face, .face::before, .face::after  {
    -webkit-perspective         : 10000;
    -moz-perspective         : 10000;
    perspective         : 10000;
    height                      : 130px;
    width                       : 100px;
    border-radius               : 6px;
}

.card {
    -webkit-transition          : all 1.5s ease-out;
    -webkit-transform-style     : preserve-3d;
    -webkit-transform           : translate(0px,0px) rotateX(-90deg);
    -webkit-transform-origin    : bottom;
    -moz-transition          : all 1.5s ease-out;
    -moz-transform-style     : preserve-3d;
    -moz-transform           : translate(0px,0px) rotateX(-90deg);
    -moz-transform-origin    : bottom;
    transition          : all 1.5s ease-out;
    transform-style     : preserve-3d;
    transform           : translate(0px,0px) rotateX(-90deg);
    transform-origin    : bottom;
    border                      : medium solid pink;
    border                      : medium solid transparent;
}

.face {
    -webkit-transition          : all 0.25s;
    -webkit-transform-origin    : bottom;
    -webkit-transform-style     : preserve-3d;
    -webkit-transform           : rotateY(0deg);
    -moz-transition          : all 0.25s;
    -moz-transform-origin    : bottom;
    -moz-transform-style     : preserve-3d;
    -moz-transform           : rotateY(0deg);
    transition          : all 0.25s;
    transform-origin    : bottom;
    transform-style     : preserve-3d;
    transform           : rotateY(0deg);
}

.face::before, .face::after {
    position                    : absolute;
    display                     : block;
    background                  : lightblue;
    content                     : " ";
    background-size             : 100% 100%;
    -webkit-backface-visibility : hidden;
    -moz-backface-visibility : hidden;
    backface-visibility : hidden;
}

.face::before {
    background-image            : url(img/cardKingClub.png);
    background-image            : url(img/cardJackClub.png);
    background-image            : url(img/cardQueenSpade.png);
    background-image            : url(img/cardJackSpade.png);
    background-image            : url(img/cardAceSpade.png);
    background-image            : url(img/cardJackHeart.png);
}

.face::after {
    background-image            : url(img/cardBack1.png);
    background-image            : url(img/cardBack2.png);
    -webkit-transform           : rotateY(180deg);
    -moz-transform           : rotateY(180deg);
    transform           : rotateY(180deg);
}


.card {
    -webkit-animation-name: "";
}


.walking > .face::after,
.walking > .face::before {
    -webkit-animation: walk 0.75s infinite;
}


@-webkit-keyframes walk {

    0% {-webkit-filter: custom(url(filters/warp.vs) mix(url(filters/warp.fs) normal source-atop), 20 20 border-box, k array(-0.5, -0.5, 0, -0.167, -0.5, 0, 0.167, -0.5, 0, 0.5, -0.5, 0, -0.5, -0.167, 0, -0.167, -0.167, 0, 0.167, -0.167, 0, 0.5, -0.167, 0, -0.5, 0.167, 0, -0.167, 0.167, 0, 0.167, 0.167, 0, 0.5, 0.167, 0, -0.5, 0.5, 0, -0.167, 0.5, 0, 0.167, 0.5, 0, 0.5, 0.5, 0), matrix perspective(1000) scale(1) rotateX(0deg) rotateY(0deg) rotateZ(0deg), useColoredBack 1, backColor 1 1 1 1);}

    25% { -webkit-filter: custom(url(filters/warp.vs) mix(url(filters/warp.fs) normal source-atop), 20 20 border-box, k array(-0.393, -0.357, 0, -0.167, -0.5, 0, 0.167, -0.5, 0, 0.371, -0.014, 0, -0.5, -0.167, 0, -0.293, -0.286, 0, 0.293, -0.3, 0, 0.5, -0.167, 0, -0.036, -0.036, 0, -0.229, 0.243, 0, -0.4, -0.514, 0, 0.5, 0.167, 0, -0.5, 0.129, 0, -0.167, 0.5, 0, 0.167, 0.5, 0, 0.486, 0.464, 0), matrix perspective(1000) scale(1) rotateX(0deg) rotateY(0deg) rotateZ(0deg), useColoredBack 1, backColor 1 1 1 1);}

    50% {-webkit-filter: custom(url(filters/warp.vs) mix(url(filters/warp.fs) normal source-atop), 20 20 border-box, k array(-0.5, -0.5, 0, -0.167, -0.5, 0, 0.167, -0.5, 0, 0.5, -0.5, 0, -0.5, -0.167, 0, -0.167, -0.167, 0, 0.167, -0.167, 0, 0.5, -0.167, 0, -0.5, 0.167, 0, -0.167, 0.167, 0, 0.167, 0.167, 0, 0.5, 0.167, 0, -0.5, 0.5, 0, -0.167, 0.5, 0, 0.167, 0.5, 0, 0.5, 0.5, 0), matrix perspective(1000) scale(1) rotateX(0deg) rotateY(0deg) rotateZ(0deg), useColoredBack 1, backColor 1 1 1 1);}

    75% { -webkit-filter: custom(url(filters/warp.vs) mix(url(filters/warp.fs) normal source-atop), 20 20 border-box, k array(-0.3, -0.064, 0, -0.167, -0.5, 0, 0.167, -0.5, 0, 0.429, -0.329, 0, -0.457, 0.043, 0, -0.15, -0.136, 0, 0.064, -0.121, 0, 0.279, -0.214, 0, -0.457, 0.193, 0, -0.386, 0.407, 0, -0.179, 0.357, 0, 0.279, 0.093, 0, -0.5, 0.5, 0, -0.167, 0.5, 0, 0.15, 0.486, 0, 0.35, 0.329, 0), matrix perspective(1000) scale(1) rotateX(0deg) rotateY(0deg) rotateZ(0deg), useColoredBack 1, backColor 1 1 1 1); }

    100% {-webkit-filter: custom(url(filters/warp.vs) mix(url(filters/warp.fs) normal source-atop), 20 20 border-box, k array(-0.5, -0.5, 0, -0.167, -0.5, 0, 0.167, -0.5, 0, 0.5, -0.5, 0, -0.5, -0.167, 0, -0.167, -0.167, 0, 0.167, -0.167, 0, 0.5, -0.167, 0, -0.5, 0.167, 0, -0.167, 0.167, 0, 0.167, 0.167, 0, 0.5, 0.167, 0, -0.5, 0.5, 0, -0.167, 0.5, 0, 0.167, 0.5, 0, 0.5, 0.5, 0), matrix perspective(1000) scale(1) rotateX(0deg) rotateY(0deg) rotateZ(0deg), useColoredBack 1, backColor 1 1 1 1);}

}

</style>

</head>
<body>

<section class="scene">
<section class="ground">

<div class="card">
    <div class="face"></div>
</div>

</section>
</section>

<script>

var app = new Function();

// auto/manual mode
app.manualMode   = 0;
app.autoDelay    = 3000; // delay until auto demo mode
app.autoInterval = 5000; // auto mode delay between strolls

app.minRadius = 200;

app.prevX        = 0;
app.prevY        = 0;
app.curX         = 0;
app.curY         = 0;
app.deltaX       = 0;
app.deltaY       = 0;

window.onload = function() {
    app.ground = document.querySelector('.ground');
    app.card = document.querySelector('.card');
    app.face = document.querySelector('.face');

    app.width = app.ground.scrollWidth;
    app.height = app.ground.scrollHeight;

    app.ground.addEventListener('click', app.handleClick);
    app.card.addEventListener('webkitTransitionEnd', app.stopWalking);
    setTimeout(app.randomDestination, app.autoDelay)
};

app.randomDestination = function() {
    if (app.manualMode) return(false);
    app.curX = Math.round(Math.random() * app.width);
    app.curY = Math.round(Math.random() * app.height);
    app.move();
    setTimeout(app.randomDestination, app.autoInterval); // rinse, repeat
}

app.handleClick = function(e) {
    app.manualMode = true;
    app.curX = e.offsetX;
    app.curY = e.offsetY;
    app.move();
}

app.move = function() {
//    var radius = 0;

    app.deltaX = app.curX - app.prevX;
    app.prevX = app.curX;
    app.deltaY = app.curY - app.prevY;
    app.prevY = app.curY;
    app.radian = Math.atan2(app.deltaX, app.deltaY);
//    radius = Math.round(Math.sqrt( Math.pow(app.deltaX, 2)  + Math.pow(app.deltaY, 2) ) );

    app.card.style.WebkitTransform = 'translate(' + app.curX + 'px , ' + app.curY + 'px) rotateX(-90deg)';
    app.face.style.WebkitTransform = 'rotateY(' + app.radian + 'rad)';
    app.card.classList.add('walking');
}

app.stopWalking = function(e) {
    if (! e.target.className.match(/walking/)) return(false);
    app.card.classList.remove('walking');
}

</script>

</body>
</html>
